<?xml version="1.0" encoding="UTF-8"?><record_update table="sys_ui_page">
    <sys_ui_page action="INSERT_OR_UPDATE">
        <category>general</category>
        <client_script><![CDATA[jQuery(function () {
  var $ = jQuery;
  var modal = GlideModal.get();

  var snIncidentId = modal.getPreference('snIncidentId');
  var sysId = modal.getPreference('sysId');
  var loading = false;

  var api = x_pd_integration.AjaxHelper.ajaxClientFor('ResponsePlayController');
  var userId = g_user.userID;

  api.checkMapping(userId, function (error, result) {
    if (error) jslog('Response Play Run: mapping check error. ' + JSON.stringify(error, null, 2));
    if (result) {
      document.querySelector('.pds-body input').removeAttribute('disabled');
      document.querySelector('.pds-body input').removeAttribute('readonly');
    } else {
      document.querySelector('.pd-response-play-mapping-check').style.visibility = 'visible';
    }
    return result;
  });

  var responsePlaySelector = new x_pd_integration.PdSelect({
    element: document.querySelector('.pd-response-play-selector'),
    initValues: function () {
      $('.pds-body input').attr('disabled', 'disabled');
      $('.pds-body input').attr('readonly', 'readonly');
    },
    load: function (text, callback) {
      api.fetchResponsePlays(userId, function (error, data) {
        if (error) {
          jslog(error);
          var message = error.message || 'Error: ' + JSON.stringify(error);
          g_form.addErrorMessage(message);
          modal.destroy();
        } else if (data.errorMessage) {
          showModalError(data.errorMessage);
        }
        callback(data);
      });
    },
    onUpdate: function (selectionId) {
      var submitElement = document.querySelector('button.btn.submit-request');
      if (selectionId) {
        submitElement.classList.remove('disabled');
      } else {
        submitElement.classList.add('disabled');
      }
    },
  });

  $('.pd-response-play-form button.submit-request').on('click', function (event) {
    event.preventDefault();
    event.stopPropagation();
    if (loading) return;
    loading = true;

    $('.pd-response-play-form button.submit-request').attr('disabled', true);
    $('.pd-response-play-form button.submit-request').html('<span class="icon icon-loading"></span> Running...');

    var payload = {
      snIncidentId: snIncidentId,
      userId: userId,
      responsePlayId: responsePlaySelector.getSelectionData().id,
      responsePlayName: responsePlaySelector.getSelectionData().name
    };

    api.runResponsePlay(payload, function (error, result) {
      if (error) {
        jslog(error.stack);
        var message = error.message || 'Error. Details: ' + JSON.stringify(error);
        g_form.addErrorMessage(message);
      } else {
        g_form.addInfoMessage(result.message);
      }

      modal.destroy();
    });
  });


  $('.pd-response-play-form button.submit-cancel').on('click', function (event) {
    event.preventDefault();
    event.stopPropagation();
    modal.destroy();
  });
});

function showModalError (message) {
  document.querySelector('.pds-suggestions').style.visibility = 'hidden';
  document.querySelector('.pd-response-play-form .form-group').style.visibility = 'hidden';
  document.querySelector('.pd-response-play-form .pd-message').innerHTML = message;
  document.querySelector('.pd-response-play-form .pd-message').style.visibility = 'visible';
}
]]></client_script>
        <description>Run PagerDuty Response Play Dialog</description>
        <direct>false</direct>
        <endpoint>x_pd_integration_run_response_play_dialog_DEPRECATED.do</endpoint>
        <html><![CDATA[<?xml version="1.0" encoding="utf-8" ?>
<j:jelly trim="false" xmlns:j="jelly:core" xmlns:g="glide" xmlns:j2="null" xmlns:g2="null">
  <g:evaluate var="jvar_stamp" expression="new Date().getTime()" />
  <script language="javascript" src="x_pd_integration.AjaxHelper.jsdbx?v=${HTML:jvar_stamp}"></script>
  <script language="javascript" src="x_pd_integration.PdSelect.jsdbx?v=${HTML:jvar_stamp}"></script>

  <g:evaluate>
    var pdLogo = gs.getProperty('x_pd_integration.pd_logo');
  </g:evaluate>

  <form class="form_body form-horizontal pd-response-play-form">
    <style>
      .form_body {
          background-color: #fff;
      }
      .pd-message {
        text-align: center;
      }
      .pd-response-play-form {
        margin: 1rem;
      }
    </style>
    <div class="row">
      <div class="col-sm-12">
        <p class="pd-message" style="visibility: hidden;">(placeholder for message)</p>
        <div class="form-group">
          <label class="col-xs-12 col-md-3 col-lg-4 control-label" style="padding: 0.75rem 0;">
            <span class="label-text">Select Response Play</span>
          </label>
          <div class="col-xs-10 col-sm-9 col-md-6 col-lg-5 form-field pd-response-play-selector">
            <div class="input-group ref-container">
              <input value="" class="form-control element_reference_input" />
            </div>
          </div>
          <div class="col-xs-12" style="display: flex; padding: 0">
            <div class="col-xs-10 col-sm-9 col-md-6 col-lg-5 pd-response-play-mapping-check" style="visibility: hidden; padding-top: 2.5rem; margin: 0 auto; font-size: 1.25rem; color: grey">
              Your ServiceNow user account is not linked to your PagerDuty account. Please ensure your PagerDuty user ID and email are present on your ServiceNow user record.
            </div>
          </div>
        </div>
      </div>
    </div>

    <div class="row" style="margin-top: 10rem">
      <div class="col-sm-12">
        <div class="pull-left" style="padding: 6px 9px;">
          <img width="120" alt="PagerDuty Logo" src="${HTML:pdLogo}" />
        </div>
        <div class="pull-right">
          <button class="btn btn-default submit-cancel" style="margin-right: 1rem">Cancel</button>
          <button class="btn btn-primary submit-request disabled">Continue</button>
        </div>
      </div>
    </div>
  </form>
</j:jelly>
]]></html>
        <name>run_response_play_dialog_DEPRECATED</name>
        <processing_script/>
        <sys_class_name>sys_ui_page</sys_class_name>
        <sys_created_by>PagerDuty_v8.0</sys_created_by>
        <sys_created_on>2020-03-20 22:00:29</sys_created_on>
        <sys_id>e9e48bef2f6b00101bf7ffecf699b60e</sys_id>
        <sys_mod_count>13</sys_mod_count>
        <sys_name>run_response_play_dialog_DEPRECATED</sys_name>
        <sys_package display_value="PagerDuty Incident Resolution Platform" source="x_pd_integration">39a9d9664f834e00dd657bb28110c77b</sys_package>
        <sys_policy/>
        <sys_scope display_value="PagerDuty Incident Resolution Platform">39a9d9664f834e00dd657bb28110c77b</sys_scope>
        <sys_update_name>sys_ui_page_e9e48bef2f6b00101bf7ffecf699b60e</sys_update_name>
        <sys_updated_by>PagerDuty_v8.0</sys_updated_by>
        <sys_updated_on>2023-09-28 09:28:20</sys_updated_on>
    </sys_ui_page>
</record_update>
