<?xml version="1.0" encoding="UTF-8"?><record_update table="sys_ui_script">
    <sys_ui_script action="INSERT_OR_UPDATE">
        <active>true</active>
        <description/>
        <global>false</global>
        <name>x_pd_integration.ConferenceBridgeConfigu</name>
        <script>/*jshint esnext: true */

var x_pd_integration = x_pd_integration || {};

x_pd_integration.ConferenceBridgeConfigurator = (function() {
  "use strict";

  var api = x_pd_integration.AjaxHelper.ajaxClientFor('AddConferenceBridgeController');
  var css = document.createElement('style');
  css.innerHTML = `
      `;
  document.body.appendChild(css);

  class ConferenceBridgeConfigurator {
    constructor({element, snIncidentId}) {
	  this.snIncidentId = snIncidentId;

	element.innerHTML = `
      &lt;div class="row pd-conference-bridge-body"&gt;
        &lt;div class="col-sm-12"&gt;
            &lt;div class="form-group"&gt;
                &lt;div&gt;
                    &lt;label class=" col-xs-12 col-md-3 col-lg-4 control-label"&gt;
                        &lt;span class="label-text"&gt;Conference Bridge&lt;/span&gt;
                    &lt;/label&gt;
                &lt;/div&gt;
                &lt;div class="col-xs-10 col-sm-9 col-md-6 col-lg-5 form-field input_controls pd-group-selector"&gt;
					&lt;select class="form-control" id="conf-bridge-list" value="--custom--"&gt;
					&lt;/select&gt;
				&lt;/div&gt;
            &lt;/div&gt;

            &lt;div class="form-group"&gt;
                &lt;div&gt;
                    &lt;label class=" col-xs-12 col-md-3 col-lg-4 control-label"&gt;
                        &lt;span class="label-text"&gt;Dial-In Number&lt;/span&gt;
                    &lt;/label&gt;
                &lt;/div&gt;
                &lt;div class="col-xs-10 col-sm-9 col-md-6 col-lg-5 form-field input_controls pd-user-selector"&gt;
                   &lt;input class="form-control" id="conf-bridge-number"/&gt;
                &lt;/div&gt;
            &lt;/div&gt;

            &lt;div class="form-group"&gt;
                &lt;div&gt;
                    &lt;label class=" col-xs-12 col-md-3 col-lg-4 control-label"&gt;
                        &lt;span class="label-text"&gt;URL&lt;/span&gt;
                    &lt;/label&gt;
                &lt;/div&gt;
                &lt;div class="col-xs-10 col-sm-9 col-md-6 col-lg-5 form-field input_controls"&gt;
                   &lt;input class="form-control" id="conf-bridge-url" maxlength="500"/&gt;
                &lt;/div&gt;
            &lt;/div&gt;
        &lt;/div&gt;
    &lt;/div&gt;
      `;

	this.allConfBridges = undefined;
	this.currentConfBridges = undefined;

	api.loadConferenceBridges((error, result) =&gt; {
		if (error) {
			if (this.onError) this.onError(error);
		} else {
			this.options = result;

			result.unshift({
				value: '--custom--',
				name: '--custom--',
				ulr: '',
				number: '',
			});

			var html = result.map(r =&gt; {
				return '&lt;option value="' +  r.value + '"&gt;' + r.name + '&lt;/option&gt;' ;
			}).join('');

			jQuery(".pd-conference-bridge-body #conf-bridge-list").html(html);
			this.allConfBridges = result;
			this.prepopulate();
		}
	});

	api.loadCurrentConferenceBridge(this.snIncidentId, (error, currentBridge) =&gt; {
		if (error) {
			if (this.onError) this.onError(error);
		} else {
			this.currentConfBridges = currentBridge;
			this.prepopulate();
		}
	});

	jQuery(".pd-conference-bridge-body #conf-bridge-list").change(() =&gt; {
		const val = jQuery(".pd-conference-bridge-body #conf-bridge-list").val();
		const o = this.options.find(o =&gt; o.value === val);
		if (o) {
			jQuery(".pd-conference-bridge-body #conf-bridge-url").val(o.url);
			jQuery(".pd-conference-bridge-body #conf-bridge-number").val(o.number);
		}
	});
    }

	submitRequest(done) {
		const url = jQuery(".pd-conference-bridge-body #conf-bridge-url").val();
		const number = 	jQuery(".pd-conference-bridge-body #conf-bridge-number").val();
		api.addConferenceBridges(this.snIncidentId, g_user.userID, number, url, done);
	}

	prepopulate() {
		if (!this.allConfBridges || !this.currentConfBridges) {
			return;
		}

		let {conference_url, conference_number}  = this.currentConfBridges;
		if (!conference_url) conference_url = '';
		if (!conference_number) conference_number = '';

		if (conference_url &amp;&amp; !jQuery(".pd-conference-bridge-body #conf-bridge-url").val()) {
			jQuery(".pd-conference-bridge-body #conf-bridge-url").val(conference_url);
		}
		if (conference_number &amp;&amp; !jQuery(".pd-conference-bridge-body #conf-bridge-number").val()) {
			jQuery(".pd-conference-bridge-body #conf-bridge-number").val(conference_number);
		}

		for (let c of this.allConfBridges) {
			let {url, number, value} = c;
			if (!url) url = '';
			if (!number) number = '';
			if (url.toLowerCase() === conference_url.toLowerCase()
				&amp;&amp; number.toLowerCase() === conference_number.toLowerCase()) {
				if (jQuery(".pd-conference-bridge-body #conf-bridge-list").val() === '--custom--') {
					jQuery(".pd-conference-bridge-body #conf-bridge-list").val(value);
					break;
				}
			}
		}


	}
  }

  return ConferenceBridgeConfigurator;
})();
</script>
        <script_name>ConferenceBridgeConfigurator</script_name>
        <sys_class_name>sys_ui_script</sys_class_name>
        <sys_created_by>PagerDuty_v8.0</sys_created_by>
        <sys_created_on>2019-04-12 12:35:11</sys_created_on>
        <sys_id>58f9a6cddbb03300eb140181ca96193a</sys_id>
        <sys_mod_count>35</sys_mod_count>
        <sys_name>x_pd_integration.ConferenceBridgeConfigu</sys_name>
        <sys_package display_value="PagerDuty Incident Resolution Platform" source="x_pd_integration">39a9d9664f834e00dd657bb28110c77b</sys_package>
        <sys_policy/>
        <sys_scope display_value="PagerDuty Incident Resolution Platform">39a9d9664f834e00dd657bb28110c77b</sys_scope>
        <sys_update_name>sys_ui_script_58f9a6cddbb03300eb140181ca96193a</sys_update_name>
        <sys_updated_by>PagerDuty_v8.0</sys_updated_by>
        <sys_updated_on>2020-02-11 13:15:30</sys_updated_on>
        <ui_type>0</ui_type>
        <use_scoped_format>true</use_scoped_format>
    </sys_ui_script>
</record_update>
