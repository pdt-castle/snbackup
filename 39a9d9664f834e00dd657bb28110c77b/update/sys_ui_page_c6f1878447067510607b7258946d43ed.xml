<?xml version="1.0" encoding="UTF-8"?><record_update table="sys_ui_page">
    <sys_ui_page action="INSERT_OR_UPDATE">
        <category>general</category>
        <client_script><![CDATA[var $J = jQuery;

function showErrorToast (title, message) {
  if (title) {
    $J('#error-title').text(title);
  }
  if (message) {
    $J('#error-message').text(message);
  }
  $J('#error').show();
}

function trackEvent () {
  var trackingApi = x_pd_integration.AjaxHelper.ajaxClientFor('TrackingController');
  trackingApi.track('custom_fields_mapping_click_navigation_module', {}, function (error, _result) {
    if (error) {
      jslog('Tracking error: ' + error);
    }
  });
}


$J('#migrate-webhook').on('click', function () {
  g_navigation.open('x_pd_integration_webhooks_migration.do');
});

$J(function () {
  trackEvent();
  var customFieldsApi = x_pd_integration.AjaxHelper.ajaxClientFor('PagerDutyCustomFieldsController');
  customFieldsApi.checkCustomFieldMappingAbility(function (errorCheck, response) {
    if (response.status === 204) {
      customFieldsApi.getAllCustomFieldsMappings(function (errorMappings, mappings) {
        if (errorMappings) {
          $J('#main').show();
          showErrorToast('There was an error getting the custom field mappings.', 'Unexpected error.');
        }
        if (mappings.length > 0) {
          g_navigation.open('x_pd_integration_custom_field_mapping_list.do');
        } else if (g_webhooksV2Identified === 'true') {
          $J('#main').show();
          $J('#migrate-webhook-view').show();
        } else {
          g_navigation.open('x_pd_integration_custom_field_mapping_list.do');
        }
      });
    } else if (response.status === 402 || response.status === 404) {
      $J('#main').show();
      $J('#contact-sales-view').show();
    } else {
      $J('#main').show();
      showErrorToast('There was an error communicating with PagerDuty.', response.body);
    }
  });
});
]]></client_script>
        <description>Intermediate Custom field mapping UI page to validate access requirements</description>
        <direct>false</direct>
        <endpoint>x_pd_integration_custom_field_mapping_validate_access.do</endpoint>
        <html><![CDATA[<?xml version="1.0" encoding="utf-8" ?>
<j:jelly trim="false" xmlns:j="jelly:core" xmlns:g="glide" xmlns:j2="null" xmlns:g2="null">
  <g:evaluate var="jvar_stamp" expression="new Date().getTime()" />
  <script language="javascript" src="x_pd_integration.AjaxHelper.jsdbx?v=${HTML:jvar_stamp}"></script>

  <script>
    var g_webhooksV2Identified = "${gs.getProperty('x_pd_integration.webhooks_v2_identified')}";
  </script>

  <style>
    p {
      margin: 0;
    }

    .message {
      max-width: 555px;
    }

    .image, .message, .actions {
      margin: 0 auto;
      margin-bottom: 24px;
      text-align: center;
    }
    .image {
      margin-top: 24px;
    }
    .message .message-primary {
      color: var(--text-text-primary, #151920);
      font-size: 24px;
      font-weight: 600;
      margin-bottom: 24px;
    }
    .message .message-secondary {
      color: var(--text-text-tertiary, #454D5B);
      font-size: 16px;
      font-weight: 400;
      margin: 0;
    }

    .navbar-header {
      height: 48px;
    }

    .navbar .navbar-title {
      font-weight: 800;
    }

    .view {
      margin-top: 80px;
    }

    .notification {
			padding: 16px;
		}

		.notification-content {
			display: flex;
			gap: 8px;
		}

		.notification-error .notification-icon {
			width: 21px;
			height: 21px;
			background-image: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="21" height="21" viewBox="0 0 21 21" fill="%23161B1C" > <path fill-rule="evenodd" clip-rule="evenodd" d="M7.938 2.016A.13.13 0 0 1 8.002 2a.13.13 0 0 1 .063.016.146.146 0 0 1 .054.057l6.857 11.667c.036.06.035.124.002.183a.163.163 0 0 1-.054.06.116.116 0 0 1-.066.017H1.146a.115.115 0 0 1-.066-.017.163.163 0 0 1-.054-.06.176.176 0 0 1 .002-.183L7.884 2.073a.147.147 0 0 1 .054-.057zm1.044-.45a1.13 1.13 0 0 0-1.96 0L.165 13.233c-.457.778.091 1.767.98 1.767h13.713c.889 0 1.438-.99.98-1.767L8.982 1.566z" /> <path fill-rule="evenodd" clip-rule="evenodd" d="M7.002 12a1 1 0 1 1 2 0 1 1 0 0 1-2 0zM7.1 5.995a.905.905 0 1 1 1.8 0l-.35 3.507a.552.552 0 0 1-1.1 0L7.1 5.995z" /> </svg> ');
		}

    #error {
      margin: 10px;
    }

    #main {
      margin: -6px;
    }

    #migrate-webhook-view, #contact-sales-view  {
      padding: 0px 24px 0px 24px;
      margin-bottom: 16px;
    }

    #main, #error, #migrate-webhook-view, #contact-sales-view {
      display: none;
    }
  </style>

  <div id="main">
    <div class="navbar navbar-default list_nav list_nav_top  list_nav_top_border">
      <div class="container-fluid ">
        <div class="navbar-header">
          <h1 class="navbar-title">PagerDuty Custom Field Mappings</h1>
        </div>
      </div>
    </div>

    <div id="error">
      <div class="notification notification-error">
        <div class="notification-content">
          <div class="notification-icon"></div>
          <div>
            <p><b id="error-title">There was an error loading the page.</b></p>
            <p id="error-message">Unexpected error.</p>
          </div>
        </div>
      </div>
    </div>

    <div id="migrate-webhook-view" class="view">
      <div class="image">
        <img src="x_pd_integration.unconfigured.svg"></img>
      </div>

      <div class="message">
        <p class="message-primary">REQUIRED: Migrate to Webhook V3 to start using PagerDuty Custom Field Mappings.</p>
        <p class="message-secondary">Your account is currently using PagerDuty Webhook V2. Webhook V3 is required for PagerDuty Custom Fields bidirectional sync. Click the button below to migrate.</p>
      </div>

      <div class="actions">
        <button id="migrate-webhook" class="btn btn-primary">Migrate to Webhook V3</button>
      </div>
    </div>

    <div id="contact-sales-view" class="view">
      <div class="image">
        <img src="x_pd_integration.permissions.svg"></img>
      </div>

      <div class="message">
        <p class="message-primary">Create a single source of truth with automatic sync between ServiceNow and PagerDuty Custom Fields</p>
        <p class="message-secondary">Map and mirror data between ServiceNow and PagerDuty with Custom Field Mappings. Once mapped, updates to one field are mirrored to the other. Upgrade to Enterprise Incident Management package and start configuring your mapping today.</p>
      </div>

      <div class="actions">
        <a href="https://www.pagerduty.com/contact-us/?utm_source=servicenow_itsm&amp;utm_content=custom_field_mapping_click_contact_sales_button" class="btn btn-primary" role="button" target="_blank" rel="noopener noreferrer">Contact Sales</a>
      </div>
    </div>

  </div>

</j:jelly>]]></html>
        <name>custom_field_mapping_validate_access</name>
        <processing_script/>
        <sys_class_name>sys_ui_page</sys_class_name>
        <sys_created_by>PagerDuty_v8.0</sys_created_by>
        <sys_created_on>2023-10-18 08:33:11</sys_created_on>
        <sys_id>c6f1878447067510607b7258946d43ed</sys_id>
        <sys_mod_count>0</sys_mod_count>
        <sys_name>custom_field_mapping_validate_access</sys_name>
        <sys_package display_value="PagerDuty Incident Resolution Platform" source="x_pd_integration">39a9d9664f834e00dd657bb28110c77b</sys_package>
        <sys_policy/>
        <sys_scope display_value="PagerDuty Incident Resolution Platform">39a9d9664f834e00dd657bb28110c77b</sys_scope>
        <sys_update_name>sys_ui_page_c6f1878447067510607b7258946d43ed</sys_update_name>
        <sys_updated_by>PagerDuty_v8.0</sys_updated_by>
        <sys_updated_on>2023-10-18 08:33:11</sys_updated_on>
    </sys_ui_page>
</record_update>
