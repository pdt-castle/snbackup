<?xml version="1.0" encoding="UTF-8"?><record_update table="sys_transform_map">
    <sys_transform_map action="INSERT_OR_UPDATE">
        <active>true</active>
        <copy_empty_fields>false</copy_empty_fields>
        <create_new_record_on_empty_coalesce_fields>false</create_new_record_on_empty_coalesce_fields>
        <enforce_mandatory_fields>No</enforce_mandatory_fields>
        <name>PagerDuty Webhook Import</name>
        <order>100</order>
        <run_business_rules>true</run_business_rules>
        <run_script>true</run_script>
        <script><![CDATA[// NOTE: This code is also executed by "Change Requests" and "Security Incidents"
//       because they share the same "Source table".

// We need to allow relaying the webhooks from the webhooks import table to the response requests table:
// webhook -> [x_pd_integration_webhook_import] -> [x_pd_integration_pagerduty_response_requests_import]
// -> [x_pd_integration_pagerduty_response_requests]

var tablesAllowed = ['incident', 'x_pd_integration_pagerduty_response_requests_import'];
var targetTable = source.getValue('target_table');
var eligibleToRun = ''.includes.call(tablesAllowed, targetTable);

if (!eligibleToRun) {
  ignore = true;
} else {
  try {
    var payload = JSON.parse(source.getValue('payload'));
    var v3wh = new x_pd_integration.v3webhook();

    if (source.getValue('message_type') === 'incident.action.trigger') {
      x_pd_integration.PdWebhookTransformAction.tryTransform();
    } else if (v3wh.isSupported({event: payload})) {
      x_pd_integration.PdWebhookTransformV3.tryTransform();
    } else {
      x_pd_integration.PdWebhookTransform.tryTransform();
    }
  } catch (e) {
    gs.error(e.message);
  }
}
]]></script>
        <source_table>x_pd_integration_webhook_import</source_table>
        <sys_class_name>sys_transform_map</sys_class_name>
        <sys_created_by>PagerDuty_v8.0</sys_created_by>
        <sys_created_on>2015-10-26 15:28:19</sys_created_on>
        <sys_id>0c18f19e4f1fce00dd657bb28110c76f</sys_id>
        <sys_mod_count>208</sys_mod_count>
        <sys_name>PagerDuty Webhook Import</sys_name>
        <sys_package display_value="PagerDuty Incident Resolution Platform" source="x_pd_integration">39a9d9664f834e00dd657bb28110c77b</sys_package>
        <sys_policy/>
        <sys_scope display_value="PagerDuty Incident Resolution Platform">39a9d9664f834e00dd657bb28110c77b</sys_scope>
        <sys_update_name>sys_transform_map_0c18f19e4f1fce00dd657bb28110c76f</sys_update_name>
        <sys_updated_by>PagerDuty_v8.0</sys_updated_by>
        <sys_updated_on>2018-04-18 12:37:14</sys_updated_on>
        <target_table>incident</target_table>
    </sys_transform_map>
</record_update>
