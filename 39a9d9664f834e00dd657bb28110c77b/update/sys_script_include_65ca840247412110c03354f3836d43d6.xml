<?xml version="1.0" encoding="UTF-8"?><record_update table="sys_script_include">
    <sys_script_include action="INSERT_OR_UPDATE">
        <access>package_private</access>
        <active>true</active>
        <api_name>x_pd_integration.TestHelper</api_name>
        <caller_access/>
        <client_callable>false</client_callable>
        <description/>
        <name>TestHelper</name>
        <script>/*** Changes made to this script are not supported by PagerDuty ***/
var TestHelper = Class.create();
TestHelper.prototype = {
  initialize: function () {
    this.JSON = new global.JSON();
    this.rest = new x_pd_integration.PagerDuty_REST();
  },

  deprovisionEscalationPolicy: function (name) {
    var response = this.rest.getREST('escalation_policies/?query=' + gs.urlEncode(name));
    if (this.rest.hasError()) {
      throw new Error(this.rest.getError());
    }
    var responseBody = response.haveError() ? this.extractError(response) : response.getBody();
    var status = response.getStatusCode();
    if (status !== 200) {
      throw new Error(responseBody);
    }
    var body = JSON.parse(responseBody);
    var eps = body.escalation_policies;
    eps.forEach(function (ep) {
      response = this.rest.deleteREST('escalation_policies/' + ep.id);
      if (this.rest.hasError()) {
        throw new Error(this.rest.getError());
      }
      var responseBody = response.haveError() ? this.extractError(response) : response.getBody();
      var status = response.getStatusCode();
      if (status !== 204) {
        throw new Error(responseBody);
      }
    }, this);
  },

  extractError: function (response) {
    var errMsg;
    var responseBody = this.JSON.decode(response.getBody());
    if (responseBody.hasOwnProperty('message')) {
      errMsg = responseBody.message;
    } else {
      errMsg = response.getBody();
    }
    if (!errMsg) {
      errMsg = response.getErrorMessage();
    }
    return errMsg;
  },

  type: 'TestHelper',
};
</script>
        <sys_class_name>sys_script_include</sys_class_name>
        <sys_created_by>PagerDuty_v8.0</sys_created_by>
        <sys_created_on>2023-02-17 11:04:16</sys_created_on>
        <sys_id>65ca840247412110c03354f3836d43d6</sys_id>
        <sys_mod_count>15</sys_mod_count>
        <sys_name>TestHelper</sys_name>
        <sys_package display_value="PagerDuty Incident Resolution Platform" source="x_pd_integration">39a9d9664f834e00dd657bb28110c77b</sys_package>
        <sys_policy/>
        <sys_scope display_value="PagerDuty Incident Resolution Platform">39a9d9664f834e00dd657bb28110c77b</sys_scope>
        <sys_update_name>sys_script_include_65ca840247412110c03354f3836d43d6</sys_update_name>
        <sys_updated_by>PagerDuty_v8.0</sys_updated_by>
        <sys_updated_on>2023-02-17 16:48:14</sys_updated_on>
    </sys_script_include>
</record_update>
