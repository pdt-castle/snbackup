<?xml version="1.0" encoding="UTF-8"?><record_update table="sys_script_include">
    <sys_script_include action="INSERT_OR_UPDATE">
        <access>package_private</access>
        <active>true</active>
        <api_name>x_pd_integration.PagerDutyWebhooksMigrationController</api_name>
        <caller_access/>
        <client_callable>true</client_callable>
        <description> To process data received from the front end (selected records' sys_ids from the webhooks).</description>
        <name>PagerDutyWebhooksMigrationController</name>
        <script>/*** Changes made to this script are not supported by PagerDuty ***/
var PagerDutyWebhooksMigrationController = Class.create();
PagerDutyWebhooksMigrationController.prototype = Object.extendsObject(global.AbstractAjaxProcessor, {
  type: 'PagerDutyWebhooksMigrationController',

  /**
   * Runs migration to webhooks v2 selected (by sys_ids parameter or 'all'), creating a job record and queueing the event
   *
   * @returns {Object} - job record
   */
  runMigration: function () {
    var response;
    var error = null;
    try {
      var sysIds = this.getParameter('sysparm_ids');

      // create migration job record
      var grNewJob = new GlideRecord('x_pd_integration_pagerduty_webhooks_jobs');
      grNewJob.initialize();
      grNewJob.setValue('type', 'migration');
      grNewJob.setValue('status', 'running');
      grNewJob.setValue('step', 'Initializing');
      var data = {
        sysIds: sysIds,
        completePercentage: 0,
      };
      grNewJob.setValue('data', JSON.stringify(data));
      grNewJob.insert();
      // queueing the event migrate_webhooks with sysIds params
      gs.eventQueue('x_pd_integration.migrate_webhooks', grNewJob, sysIds);

      response = {status: grNewJob.getValue('status'), sys_id: grNewJob.getValue('sys_id')};
    } catch (ex) {
      error = ex.message;
      response = null;
    } finally {
      return JSON.stringify({
        error: error,
        result: response,
      });
    }
  }
});
</script>
        <sys_class_name>sys_script_include</sys_class_name>
        <sys_created_by>PagerDuty_v8.0</sys_created_by>
        <sys_created_on>2023-08-16 13:51:58</sys_created_on>
        <sys_id>07bd237bc3ecbd10743293477d013190</sys_id>
        <sys_mod_count>0</sys_mod_count>
        <sys_name>PagerDutyWebhooksMigrationController</sys_name>
        <sys_package display_value="PagerDuty Incident Resolution Platform" source="x_pd_integration">39a9d9664f834e00dd657bb28110c77b</sys_package>
        <sys_policy>read</sys_policy>
        <sys_scope display_value="PagerDuty Incident Resolution Platform">39a9d9664f834e00dd657bb28110c77b</sys_scope>
        <sys_update_name>sys_script_include_07bd237bc3ecbd10743293477d013190</sys_update_name>
        <sys_updated_by>PagerDuty_v8.0</sys_updated_by>
        <sys_updated_on>2023-08-16 13:51:58</sys_updated_on>
    </sys_script_include>
</record_update>
